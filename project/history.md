# История изменений проекта

## 2025-04-21 16:25
- Исправлена обработка дат в формате timestamp для поля createDate
- Реализована фильтрация транзакций - обрабатываются только завершенные (COMPLETED)
- Добавлена защита от некорректных дат с использованием parseInt и проверок на NaN
- Улучшено логирование процесса создания и обновления записей транзакций

## 2025-04-21 16:20
- Исправлена проблема с получением транзакций из API Bybit
- Изменен формат временных меток с секунд на миллисекунды при запросе к API
- Исправлена функция преобразования транзакций для корректного маппинга полей API
- Добавлена обработка полей createDate вместо createTime
- Реализовано использование notifyTokenQuantity для поля amount
- Улучшено логирование для отладки процесса преобразования транзакций
- Добавлена защита от отсутствующих полей в ответе API

## 2025-04-21 15:22
- Исправлена ошибка "Request parameter error" при запросах к API Bybit
- Реализовано преобразование временных меток в секунды вместо миллисекунд
- Внедрен фиксированный диапазон дат за последние 3 дня вместо динамического расчета
- Увеличено количество запрашиваемых страниц (size=10) для получения большего количества транзакций
- Добавлена строгая валидация временных меток в диапазоне 2020-2025 годов
- Улучшено логирование временных меток с выводом дат в человекочитаемом формате и UNIX-времени

## 2025-04-21 15:10
- Добавлена поддержка парсинга транзакций из BybitCabinet в модель BybitTransactionFromCabinet
- Реализован метод syncAllBybitCabinets для синхронизации всех аккаунтов BybitCabinet
- Добавлен метод processUnprocessedCabinetTransactions для обработки непроцессированных транзакций из кабинетов
- Исправлена ошибка с временными метками, добавлена автоматическая коррекция некорректных значений
- Улучшено логирование временных параметров для облегчения отладки
- Исправлена ошибка с константой endTime, заменена на изменяемую переменную

## 2025-04-09 15:17
- Исправлены ошибки в реализации сервиса извлечения номеров телефонов
- Добавлена связь между моделями BybitTransaction и BybitOrderInfo в схеме Prisma
- Исправлен метод поиска необработанных транзакций
- Устранена ошибка с неопределенной переменной startTime

## 2025-04-09 15:00
- Добавлена функциональность для обработки неиспользованных транзакций Bybit
- Реализовано получение сообщений чата для заявок через API Bybit
- Разработан метод извлечения телефонных номеров из текста сообщений с поддержкой различных форматов
- Создание записей в модели `BybitOrderInfo` для хранения найденных телефонных номеров
- Обновлен процесс синхронизации для автоматического извлечения телефонных номеров из всех необработанных заявок

## 2025-04-08 15:00
- Создан сервис автоматической синхронизации Bybit транзакций (`sync-service.ts`)
- Реализована интеграция с Prisma ORM для работы с базой данных
- Добавлена многоуровневая система обработки ошибок с повторными попытками
- Внедрена система логирования событий и ошибок
- Создан скрипт для удобного запуска сервиса синхронизации (`start-sync-service.js`)
- Сервис настроен на работу с расписанием каждые 5 минут с механизмами устойчивости

## 2025-04-08 14:44
- Добавлена многоуровневая стратегия получения данных из API Bybit
- Реализованы три стратегии запросов с разными наборами параметров
- Уменьшен временной период запроса до 1 дня для снижения нагрузки на API
- Улучшена обработка ошибок в коде с использованием try/catch и пошаговым логированием
- Устранено дублирование кода и проверок

## 2025-04-08 14:39
- Исправлена ошибка "Request parameter error" при запросе к API
- Изменен тип параметров `beginTime` и `endTime` со string на number
- Восстановлены недостающие методы в классе `BybitP2PParser`
- Добавлено дополнительное логирование параметров запроса для отладки

## 2025-04-08 14:32
- Расширены возможности класса `BybitP2PParser` в файле `bybit.ts`
- Добавлена поддержка фильтрации по статусу, времени начала и окончания
- Оптимизирована процедура получения транзакций через API
- Увеличено количество записей за запрос (до 100)
- Улучшено логирование процесса обработки данных

## 2025-04-08 14:30
- Обновлен файл `index.ts` для обработки только завершенных транзакций Bybit
- Реализовано форматирование поля `originalData` в требуемом формате JSON
- Добавлена фильтрация транзакций по статусу "completed" (50)
- Создана директория документации проекта
