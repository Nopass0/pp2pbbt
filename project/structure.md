# Структура проекта bybitParser

## Файлы и директории

```
bybitParser/
├── bybit.ts                   # Класс для работы с API Bybit, включая аутентификацию и получение транзакций
├── index.ts                  # Главный файл приложения для ручного запуска
├── sync-service.ts           # Сервис автоматической синхронизации транзакций Bybit
├── start-sync-service.js      # Скрипт для запуска сервиса синхронизации
├── package.json              # Файл конфигурации NPM с зависимостями
├── .env                      # Файл с переменными окружения
├── prisma/                   # Директория для Prisma ORM
│   └── schema.prisma       # Схема базы данных Prisma
├── logs/                     # Директория для логов работы сервиса (создается автоматически)
├── tests/                    # Директория с тестами
│   └── bybit.test.ts      # Тесты для класса BybitP2PParser
├── project/                  # Директория с документацией проекта
│   ├── history.md         # История изменений проекта
│   ├── structure.md       # Документация по структуре проекта (этот файл)
│   ├── tech.md           # Используемые технологии
│   └── requests.md        # Архив запросов пользователей
└── BybitTransaction.csv      # CSV файл с экспортированными транзакциями
├── bybit.ts          // Класс BybitP2PParser для взаимодействия с API Bybit
├── BybitTransaction.csv // CSV файл с транзакциями Bybit
├── tests/            // Директория с тестами
│   └── bybit.test.ts // Тесты для класса BybitP2PParser
├── node_modules/     // Зависимости проекта
├── package.json      // Конфигурация проекта и зависимости
└── project/          // Документация проекта
    ├── history.md    // История изменений проекта
    ├── structure.md  // Структура проекта
    ├── tech.md       // Технологии проекта
    └── requests.md   // Записи запросов пользователя
```

## Модели базы данных

### BybitTransaction
Модель для хранения транзакций Bybit:
- id - уникальный идентификатор записи
- orderNo - номер заказа в системе Bybit
- counterparty - контрагент (вторая сторона сделки)
- status - статус транзакции
- userId - идентификатор пользователя
- amount - количество криптовалюты
- asset - тип актива (криптовалюта)
- totalPrice - общая сумма в фиатной валюте
- type - тип операции (BUY/SELL)
- unitPrice - цена за единицу криптовалюты

### BybitOrderInfo
Модель для хранения информации из чатов заявок Bybit:
- id - уникальный идентификатор записи
- phoneNumbers - массив телефонных номеров, извлеченных из чата заявки
- orderNo - номер заказа в системе Bybit
- userId - идентификатор пользователя
- createdAt, updatedAt - временные метки создания и обновления записи

## Функциональные блоки

### index.ts
Главный файл приложения, который обрабатывает транзакции Bybit и экспортирует их в CSV файл в требуемом формате. Основные функции:
- Инициализация парсера Bybit
- Получение транзакций через API
- Фильтрация только завершенных транзакций
- Форматирование данных для экспорта
- Сохранение в CSV формате с правильной структурой поля originalData

### bybit.ts
Класс для взаимодействия с API Bybit, содержит методы для:
- Аутентификации на API Bybit
- Синхронизации времени с сервером
- Получения транзакций P2P
- Обработки и анализа данных транзакций
- Экспорта данных в различных форматах

### BybitTransaction.csv
CSV файл с транзакциями, содержит следующие поля:
- id - идентификатор транзакции
- orderNo - номер заказа
- counterparty - контрагент (вторая сторона сделки)
- status - статус транзакции
- userId - идентификатор пользователя
- createdAt, updatedAt, dateTime - временные метки
- amount - количество криптовалюты
- asset - тип актива (криптовалюта)
- originalData - исходные данные в JSON формате
- totalPrice - общая сумма в фиатной валюте
- type - тип операции (BUY/SELL)
- unitPrice - цена за единицу криптовалюты

### sync-service.ts
Сервис автоматической синхронизации транзакций Bybit. Основные функции:
- Периодическое получение транзакций для всех пользователей с API ключами
- Сохранение новых транзакций в базе данных PostgreSQL через Prisma ORM
- Обработка неиспользованных транзакций и извлечение номеров телефонов из чатов
- Создание записей в модели BybitOrderInfo для хранения обнаруженных номеров телефонов
- Выполнение синхронизации с заданными интервалами (по умолчанию 5 минут)
- Ведение логов работы сервиса с записью в файлы
